LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;

ENTITY MBR IS
	PORT(
		MBR_IN : IN STD_LOGIC_VECTOR(7 DOWNTO 0);
		MBR_OUT : OUT STD_LOGIC_VECTOR(7 DOWNTO 0);
		MEM_IN : OUT STD_LOGIC_VECTOR(7 DOWNTO 0);
		MEM_OUT : IN STD_LOGIC_VECTOR(7 DOWNTO 0);
		R,W : IN STD_LOGIC;
	);
END MBR;

ARCHITECTURE BEHAVI OF MBR IS
SIGNAL REG : STD_LOGIC_VECTOR(7 DOWNTO 0);
BEGIN
	PROCESS(CLK, BUS_COM, MEM_COM)
	BEGIN
		IF RISING_EDGE(CLK) THEN
			IF MEM_COM = '1' THEN
				IF MEM_RW = '1' THEN
					MEM_IN <= REG;
					RAM_RW <= '1';
				ELSE
					RAM_RW <= '0';
					REG <= MEM_OUT;
				END IF;
			ELSE
				RAM_RW <= '0';
			END IF;
			IF BUS_COM = '1' THEN
				IF BUS_RW = '1' THEN
					BUS_OUT <= REG;
				ELSE
					REG <= BUS_IN;
				END IF;
			ELSE
				BUS_OUT <= "ZZZZZZZZ";
			END IF;
		END IF;
	END PROCESS;
END;